<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rotations Robotics Field Guide - Andrew&#x27;s Notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../../../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../../../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../../../css/general-2459343d.css">
        <link rel="stylesheet" href="../../../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../../../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../../../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../../../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../../../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../../searchindex-3d639fc2.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc-d0f23d9a.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Andrew&#x27;s Notes</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="implementing-rotations-a-robotics-field-guide"><a class="header" href="#implementing-rotations-a-robotics-field-guide">Implementing Rotations: A Robotics Field Guide</a></h1>
<p><em><strong>Why?</strong></em></p>
<p>My aim here is to elucidate the complex machinery that constitutes the hard part of working with transforms and frames in robotics: rotations and rotational representations.</p>
<p>Even when working with a pre-existing software library that provides rotational representations for you, there are so many different conventions (and the implications of those conventions, often mixed together, so ingrained in the math) that without thorough documentation on the part of the library (good luck), you’re bound to be banging your head against the wall at some point. Sometimes, even understanding exactly what the functions are giving you can give you pause.</p>
<p><em>This guide is meant to be a one-stop-shop for concisely clarifying the possibilities and helping you recognize which ones you’re working with and their implications. Some convenient calculators that conform to your chosen conventions are also provided.</em></p>
<p>I’ve implemented many of these concepts in a <a href="https://github.com/goromal/manif-geom-cpp">C++ library</a> with corresponding <a href="https://github.com/goromal/geometry">Python bindings</a>. There’s also a <a href="https://gist.github.com/goromal/fb15f44150ca4e0951acaee443f72d3e">Python script</a> that implements the checks laid out in this guide for deducing the rotational conventions used by a particular library.</p>
<h2 id="introduction-conventions"><a class="header" href="#introduction-conventions">Introduction: Conventions</a></h2>
<p>Often ignored or omitted from documentation are the hidden conventions associated with a rotation representation implementation–particularly implementations that allow for converting between different representations. But conventions are very important to get right in order to ensure consistency and correctness, as well as prevent needless hours of debugging. This guide attempts to aggregate most, if not all, possible conventions for the various representations in one place. Here are the types of conventions relevant to rotational representations:</p>
<ul>
<li><strong>Ordering:</strong> Pure semantics–in what order are the components stored in memory and notationally?</li>
<li><strong>Handedness:</strong> This convention is a catch-all for intrinsic properties that determine the geometry of compositions.</li>
<li><strong>Function:</strong> Does the rotation serve to change the reference frame of a vector (Passive) or <em>move</em> the vector (Active) by its action? Note that in computer graphics, active functions are more common, whereas in robotics rotations almost always are meant to be passive. The one nuance is when library definitions associate quaternions with rotation matrices in such a way that it looks like the quaternion is acting as an active counterpart to its corresponding passive rotation matrix–more on that later.</li>
<li><strong>Directionality:</strong> A rotation is relative–the rotation of frame \(A\) relative to frame \(B\). Directionality determines which of \(A\) or \(B\) is the frame being rotated <em>from</em> and <em>to</em>. In robotics, the canonical \(A\) and \(B\) frames are often labeled as \(W\) (the “World” frame) and \(B\) (the “Body” frame). The “World” and “Body” frames are only semi-arbitrary. Regardless of conventions, it is natural to think of a rotation intuitively as going from some “static (World)” frame to some “transformed (Body)” frame.</li>
<li><strong>Perturbation:</strong> Only relevant for representations that have defined addition \(\oplus\) and subtraction \(\ominus\) operators and thus tangent-space vector aliases. Perturbation convention determines which tangent space (or “frame”) the vector belongs to. The convention is largely up to your preference, and isn’t specifically tied to the other conventions used–you just have to be consistent within your algorithm!</li>
</ul>
<p>The table below gives most, if not all, of the possible convention combinations for the rotational representations used in this guide.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>Ordering (<strong>O</strong>)</th><th>Handedness (<strong>H</strong>)</th><th>Function (<strong>F</strong>)</th><th>Directionality (<strong>D</strong>)</th><th>Perturbation (<strong>P</strong>)</th></tr>
</thead>
<tbody>
<tr><td>Rotation Matrix</td><td></td><td></td><td>Active / Passive</td><td>B2W / W2B</td><td>Local / Global</td></tr>
<tr><td>Euler Angles</td><td>3-2-1 / 3-2-3 / 3-1-3\(^{*}\)</td><td>Successive / Fixed Axes</td><td>Active / Passive</td><td>B2W / W2B</td><td></td></tr>
<tr><td>Rodrigues / Axis-Angle</td><td></td><td></td><td>Active / Passive</td><td>B2W / W2B</td><td></td></tr>
<tr><td>Quaternion</td><td>\(q_w\) first / \(q_w\) last</td><td>Right / Left</td><td>Active / Passive</td><td>B2W / W2B</td><td>Local / Global</td></tr>
</tbody>
</table>
</div>
<p>\(^{*}\) There are really \(3^3\) possible orderings of Euler Angles, though a good portion of those are redundant. The three chosen conventions in the table were chosen as (1) NASA standard airplane, (2) NASA standard aerospace, and (3) historically significant.</p>
<p>Two very popular convention groups for quaternions are called the <strong>Hamilton</strong> and <strong>Shuster/JPL</strong> conventions. This table will also include the conventions used by some members of my lab:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>Ordering (<strong>O</strong>)</th><th>Handedness (<strong>H</strong>)</th><th>Function (<strong>F</strong>)</th><th>Directionality (<strong>D</strong>)</th></tr>
</thead>
<tbody>
<tr><td>Hamilton</td><td>\(q_w\) first / last</td><td>Right</td><td>Passive</td><td>B2W</td></tr>
<tr><td>Shuster / JPL</td><td>\(q_w\) last</td><td>Left</td><td>Passive</td><td>W2B</td></tr>
<tr><td>My Lab</td><td>\(q_w\) first</td><td>Right</td><td>Active</td><td>W2B</td></tr>
</tbody>
</table>
</div>
<p>See Table 1 of the <a href="https://arxiv.org/abs/1801.07478">Flipped Quaternion Paper</a> for an overview of literature and software that use the Hamilton and Shuster / JPL conventions.</p>
<h2 id="introduction-notions-of-distance"><a class="header" href="#introduction-notions-of-distance">Introduction: Notions of Distance</a></h2>
<p>A distance metric \(\text{dist}(a,b)\) must satisfy the following properties:</p>
<ul>
<li><em>non-negativity</em>: \(\text{dist}(a,b) \geq 0\)</li>
<li><em>identity</em>: \(\text{dist}(a,b)=0 \iff a=b\)</li>
<li><em>symmetry</em>: \(\text{dist}(a,b) \geq \text{dist}(b,a)\)</li>
<li><em>triangle inequality</em>: \(\text{dist}(a,c) \leq \text{dist}(a,b) + \text{dist}(b,c)\)</li>
</ul>
<p>There are many possible choices depending on analytical/computational convenience, particularly for rotations. A good review of metrics can be found in <em>R. Hartley, J. Trumpf, Y. Dai, and H. Li. Rotation averaging. IJCV, 103(3):267-305, 2013.</em>.</p>
<h2 id="rotation-matrix"><a class="header" href="#rotation-matrix">Rotation Matrix</a></h2>
<h3 id="construction-techniques"><a class="header" href="#construction-techniques">Construction Techniques</a></h3>
<p><strong>From Frame Axes \(A\) &amp; \(B\)</strong></p>
<blockquote>
<p>F = Passive:</p>
</blockquote>
<p>$$\mathbf{R}_A^B=\begin{bmatrix}^B\mathbf{x}_A &amp; ^B\mathbf{y}_A &amp; ^B\mathbf{z}_A\end{bmatrix}$$</p>
<blockquote>
<p>F = Active:</p>
</blockquote>
<p>See <em>F = passive</em>, where \(A\) is the source frame and \(B\) is the destination frame.</p>
<p><strong>From Rotation \(\theta\) about n-Axis from World to Body</strong></p>
<ul>
<li>1 and 0’s on the n-dimension</li>
<li>Cosines on the diagonal</li>
<li>Sines everywhere else…</li>
</ul>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<ul>
<li>…Negative sine <strong>underneath</strong> the 1</li>
</ul>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<ul>
<li>…Negative sine <strong>above</strong> the 1</li>
</ul>
<blockquote>
<p>D = W2B, F = Active:</p>
</blockquote>
<ul>
<li>…Negative sine <strong>underneath</strong> the 1</li>
</ul>
<h3 id="conversions-to"><a class="header" href="#conversions-to">Conversions (To…)</a></h3>
<p><strong>Euler Angles</strong></p>
<p><em>Assuming 3-2-1 ordering, H = Successive.</em></p>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>$$\phi=\text{atan2}(R_{32},R_{33}),\quad\theta=-\arcsin(R_{31}),\quad\psi=\text{atan2}(R_{21},R_{11})$$</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>$$\phi=\text{atan2}(R_{23},R_{33}),\quad\theta=-\arcsin(R_{13}),\quad\psi=\text{atan2}(R_{12},R_{11})$$</p>
<blockquote>
<p>D = W2B, F = Active:</p>
</blockquote>
<p>Same matrix form as D = B2W, so:</p>
<p>$$\phi=\text{atan2}(R_{32},R_{33}),\quad\theta=-\arcsin(R_{31}),\quad\psi=\text{atan2}(R_{21},R_{11})$$</p>
<p>Singularity at \(\theta=\pm\pi/2\) (gimbal lock). For H = Fixed, reverse the multiplication order in the underlying matrix construction; extraction then proceeds from the transposed matrix structure.</p>
<p><strong>Rodrigues</strong></p>
<p><em>i.e., the SO(3) logarithmic map</em>.</p>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>$$\theta=\cos^{-1}\left(\frac{\text{trace}(\mathbf{R})-1}{2}\right)$$</p>
<p>if \(\theta\neq 0\):</p>
<p>$$\theta\mathbf{u} = Log(\mathbf{R}) = \frac{\theta(\mathbf{R}-\mathbf{R}^T)^\vee}{2\sin(\theta)}$$</p>
<p>else:</p>
<p>$$\theta\mathbf{u} = Log(\mathbf{R}) = \mathbf{0}$$</p>
<p>Alternatively, \(\mathbf{u}\) can be thought of as the eigenvector of \(\mathbf{R}\) that corresponds to the eigenvalue \(1\).</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>Same formula applied to \(\mathbf{R}_W^B\):</p>
<p>$$\theta\mathbf{u} = Log(\mathbf{R}) = \frac{\theta(\mathbf{R}-\mathbf{R}^T)^\vee}{2\sin(\theta)}$$</p>
<p>Since \(\mathbf{R}_W^B=(\mathbf{R}_B^W)^T\), the result is the negation of the B2W Rodrigues vector: \(Log(\mathbf{R}_W^B)=-Log(\mathbf{R}_B^W)\).</p>
<blockquote>
<p>D = W2B, F = Active:</p>
</blockquote>
<p>Same formula and result as D = B2W, since the W2B active rotation matrix is identical to the B2W passive rotation matrix.</p>
<p><strong>Quaternion</strong></p>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>\(\delta=\text{trace}(\boldsymbol{R})\)</p>
<p>if \(\delta&gt;0\) then</p>
<p>\(s=2\sqrt{\delta+1}\)</p>
<p>\(q_w=\frac{s}{4}\)</p>
<p>\(q_x=\frac{1}{s}(R_{32}-R_{23})\)</p>
<p>\(q_y=\frac{1}{s}(R_{13}-R_{31})\)</p>
<p>\(q_z=\frac{1}{s}(R_{21}-R_{12})\)</p>
<p>else if \(R_{11}&gt;R_{22}\) and \(R_{11}&gt;R_{33}\) then</p>
<p>\(s=2\sqrt{1+R_{11}-R_{22}-R_{33}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{32}-R_{23})\)</p>
<p>\(q_x=\frac{s}{4}\)</p>
<p>\(q_y=\frac{1}{s}(R_{21}+R_{12})\)</p>
<p>\(q_z=\frac{1}{s}(R_{31}+R_{13})\)</p>
<p>else if \(R_{22}&gt;R_{33}\) then</p>
<p>\(s=2\sqrt{1+R_{22}-R_{11}-R_{33}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{13}-R_{31})\)</p>
<p>\(q_x=\frac{1}{s}(R_{21}+R_{12})\)</p>
<p>\(q_y=\frac{s}{4}\)</p>
<p>\(q_z=\frac{1}{s}(R_{32}+R_{23})\)</p>
<p>else</p>
<p>\(s=2\sqrt{1+R_{33}-R_{11}-R_{22}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{21}-R_{12})\)</p>
<p>\(q_x=\frac{1}{s}(R_{31}+R_{13})\)</p>
<p>\(q_y=\frac{1}{s}(R_{32}+R_{23})\)</p>
<p>\(q_z=\frac{s}{4}\)</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>Same Shepperd extraction as D = B2W, applied to \(\mathbf{R}_W^B\). Since \(\mathbf{R}_W^B=(\mathbf{R}_B^W)^T\), this yields \(\mathbf{q}_W^B=(\mathbf{q}_B^W)^{-1}\). Equivalently, using the B2W quaternion components directly:</p>
<p>\(\delta=\text{trace}(\boldsymbol{R})\)</p>
<p>if \(\delta&gt;0\) then</p>
<p>\(s=2\sqrt{\delta+1}\)</p>
<p>\(q_w=\frac{s}{4}\)</p>
<p>\(q_x=\frac{1}{s}(R_{32}-R_{23})\)</p>
<p>\(q_y=\frac{1}{s}(R_{13}-R_{31})\)</p>
<p>\(q_z=\frac{1}{s}(R_{21}-R_{12})\)</p>
<p>else if \(R_{11}&gt;R_{22}\) and \(R_{11}&gt;R_{33}\) then</p>
<p>\(s=2\sqrt{1+R_{11}-R_{22}-R_{33}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{32}-R_{23})\)</p>
<p>\(q_x=\frac{s}{4}\)</p>
<p>\(q_y=\frac{1}{s}(R_{21}+R_{12})\)</p>
<p>\(q_z=\frac{1}{s}(R_{31}+R_{13})\)</p>
<p>else if \(R_{22}&gt;R_{33}\) then</p>
<p>\(s=2\sqrt{1+R_{22}-R_{11}-R_{33}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{13}-R_{31})\)</p>
<p>\(q_x=\frac{1}{s}(R_{21}+R_{12})\)</p>
<p>\(q_y=\frac{s}{4}\)</p>
<p>\(q_z=\frac{1}{s}(R_{32}+R_{23})\)</p>
<p>else</p>
<p>\(s=2\sqrt{1+R_{33}-R_{11}-R_{22}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{21}-R_{12})\)</p>
<p>\(q_x=\frac{1}{s}(R_{31}+R_{13})\)</p>
<p>\(q_y=\frac{1}{s}(R_{32}+R_{23})\)</p>
<p>\(q_z=\frac{s}{4}\)</p>
<p>The formulas are structurally identical to B2W, but plugging in \(\mathbf{R}_W^B\) entries (which are the transpose of \(\mathbf{R}_B^W\)) naturally produces the conjugate quaternion.</p>
<blockquote>
<p>D = W2B, F = Active:</p>
</blockquote>
<p>\(\delta=\text{trace}(\boldsymbol{R})\)</p>
<p>if \(\delta&gt;0\) then</p>
<p>\(s=2\sqrt{\delta+1}\)</p>
<p>\(q_w=\frac{s}{4}\)</p>
<p>\(q_x=\frac{1}{s}(R_{23}-R_{32})\)</p>
<p>\(q_y=\frac{1}{s}(R_{31}-R_{13})\)</p>
<p>\(q_z=\frac{1}{s}(R_{12}-R_{21})\)</p>
<p>else if \(R_{11}&gt;R_{22}\) and \(R_{11}&gt;R_{33}\) then</p>
<p>\(s=2\sqrt{1+R_{11}-R_{22}-R_{33}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{23}-R_{32})\)</p>
<p>\(q_x=\frac{s}{4}\)</p>
<p>\(q_y=\frac{1}{s}(R_{21}+R_{12})\)</p>
<p>\(q_z=\frac{1}{s}(R_{31}+R_{13})\)</p>
<p>else if \(R_{22}&gt;R_{33}\) then</p>
<p>\(s=2\sqrt{1+R_{22}-R_{11}-R_{33}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{31}-R_{13})\)</p>
<p>\(q_x=\frac{1}{s}(R_{21}+R_{12})\)</p>
<p>\(q_y=\frac{s}{4}\)</p>
<p>\(q_z=\frac{1}{s}(R_{32}+R_{23})\)</p>
<p>else</p>
<p>\(s=2\sqrt{1+R_{33}-R_{11}-R_{22}}\)</p>
<p>\(q_w=\frac{1}{s}(R_{12}-R_{21})\)</p>
<p>\(q_x=\frac{1}{s}(R_{31}+R_{13})\)</p>
<p>\(q_y=\frac{1}{s}(R_{32}+R_{23})\)</p>
<p>\(q_z=\frac{s}{4}\)</p>
<h3 id="action"><a class="header" href="#action">Action</a></h3>
<blockquote>
<p>F = passive</p>
</blockquote>
<p>$$\mathbf{R}_A^B~^A\mathbf{v}=^B\mathbf{v}$$</p>
<blockquote>
<p>F = active</p>
</blockquote>
<p>$$\mathbf{R}~^A\mathbf{v}=^A\mathbf{v}’$$</p>
<h3 id="composition-and-inversion"><a class="header" href="#composition-and-inversion">Composition and Inversion</a></h3>
<p><strong>Composition</strong></p>
<p>$$\mathbf{R}_B^C\mathbf{R}_A^B=\mathbf{R}_A^C$$</p>
<p><strong>Inversion</strong></p>
<p>$$\left(\mathbf{R}_A^B\right)^{-1}=\left(\mathbf{R}_A^B\right)^T=\mathbf{R}_B^A$$</p>
<h3 id="addition-and-subtraction"><a class="header" href="#addition-and-subtraction">Addition and Subtraction</a></h3>
<p>Perturbations are represented by \(\boldsymbol{\theta}\in \mathbb{R}^3\), where local perturbations are expressed in the body frame and global perturbations are expressed in the world frame.</p>
<p><strong>Addition</strong></p>
<blockquote>
<p>F = Passive, D = B2W, P = Local</p>
</blockquote>
<p>$$\boldsymbol{R}_{B+}^{W}=\boldsymbol{R}_{B}^{W} \text{Exp}\left(\boldsymbol{\theta}_{B+}^{B}\right)$$</p>
<blockquote>
<p>F = Passive, D = B2W, P = Global</p>
</blockquote>
<p>$$\boldsymbol{R}_{B}^{W+}=\text{Exp}\left(\boldsymbol{\theta}_{W}^{W+}\right)\boldsymbol{R}_{B}^{W}$$</p>
<blockquote>
<p>F = Passive, D = W2B, P = Local</p>
</blockquote>
<p>$$\boldsymbol{R}_{W}^{B+}=\text{Exp}\left(\boldsymbol{\theta}_{B}^{B+}\right)\boldsymbol{R}_{W}^{B}$$</p>
<p><strong>Subtraction</strong></p>
<blockquote>
<p>F = Passive, D = B2W, P = Local</p>
</blockquote>
<p>$$\boldsymbol{\theta}_{B+}^{B}=\text{Log}\left((\boldsymbol{R}_{B}^{W})^T\boldsymbol{R}_{B+}^{W}\right)$$</p>
<blockquote>
<p>F = Passive, D = B2W, P = Global</p>
</blockquote>
<p>$$\boldsymbol{\theta}_{W}^{W+}=\text{Log}\left(\boldsymbol{R}_{B}^{W+}(\boldsymbol{R}_{B}^{W})^T\right)$$</p>
<blockquote>
<p>F = Passive, D = W2B, P = Local</p>
</blockquote>
<p>$$\boldsymbol{\theta}_{B}^{B+}=\text{Log}\left(\boldsymbol{R}_{W}^{B+}(\boldsymbol{R}_{W}^{B})^T\right)$$</p>
<h3 id="notions-of-distance"><a class="header" href="#notions-of-distance">Notions of Distance</a></h3>
<p><strong>Angular/Geodesic</strong></p>
<p>Gives the effective rotation angle about the correct axis:</p>
<p>$$||Log(\mathbf{R}_A^T\mathbf{R}_B)||=||Log(\mathbf{R}_B^T\mathbf{R}_A)||$$</p>
<p><strong>Chordal</strong></p>
<p>A computational, straight-line shortcut utilizing the Frobenius norm:</p>
<p>$$||\mathbf{R}_A-\mathbf{R}_B||_F=||\mathbf{R}_B-\mathbf{R}_A||_F$$</p>
<h3 id="derivatives-and-numeric-integration"><a class="header" href="#derivatives-and-numeric-integration">Derivatives and (Numeric) Integration</a></h3>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>$$\dot{\mathbf{R}}_B^W=\mathbf{R}_B^W[\boldsymbol{\omega}^B]_\times=[\boldsymbol{\omega}^W]_\times\mathbf{R}_B^W$$</p>
<p>where \(\boldsymbol{\omega}^B\) and \(\boldsymbol{\omega}^W\) are the angular velocity expressed in the body and world frames, respectively.</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>$$\dot{\mathbf{R}}_W^B=-[\boldsymbol{\omega}^B]_\times\mathbf{R}_W^B=-\mathbf{R}_W^B[\boldsymbol{\omega}^W]_\times$$</p>
<p><strong>Numeric Integration (first-order):</strong></p>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>$$\mathbf{R}_B^W(t+\Delta t)\approx\mathbf{R}_B^W(t)\cdot Exp(\boldsymbol{\omega}^B\Delta t)$$</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>$$\mathbf{R}_W^B(t+\Delta t)\approx Exp(-\boldsymbol{\omega}^B\Delta t)\cdot\mathbf{R}_W^B(t)$$</p>
<h3 id="representational-strengths-and-shortcomings"><a class="header" href="#representational-strengths-and-shortcomings">Representational Strengths and Shortcomings</a></h3>
<p><strong>Strengths</strong></p>
<ul>
<li>Excellent for calculations</li>
</ul>
<p><strong>Shortcomings</strong></p>
<ul>
<li>Not very human-readable</li>
<li>Clearly redundant with 9 numbers for a 3-DOF quantity</li>
</ul>
<h3 id="unit-tests-to-determine-conventions"><a class="header" href="#unit-tests-to-determine-conventions">Unit Tests to Determine Conventions</a></h3>
<ol>
<li>Verify \(\mathbf{R}^T\mathbf{R}=\mathbf{I}\) and \(\det(\mathbf{R})=1\).</li>
<li>Construct a rotation of \(\theta=90°\) about the z-axis.</li>
<li>Apply \(\mathbf{R}\) to \(\mathbf{v}=[1,0,0]^T\):
<ul>
<li>Result \([0,1,0]^T\): <strong>F = Active</strong> or <strong>(F = Passive, D = B2W)</strong>.</li>
<li>Result \([0,-1,0]^T\): <strong>F = Passive, D = W2B</strong>.</li>
</ul>
</li>
<li>To distinguish Active from Passive B2W: compose two 90° rotations about z, then about x. Check whether frame subscripts cancel (Passive) or the operation moves the vector (Active).</li>
<li>Identity check: \(\mathbf{R}(0)=\mathbf{I}\) for any axis.</li>
</ol>
<h2 id="euler-angles"><a class="header" href="#euler-angles">Euler Angles</a></h2>
<p><em>Assuming 3-2-1 ordering.</em></p>
<h3 id="construction-techniques-1"><a class="header" href="#construction-techniques-1">Construction Techniques</a></h3>
<p><strong>From visualizing rotations from World to Body axes</strong></p>
<p>First consideration: Order. Follow the exact order in a straightforward fashion.</p>
<p>Second, handedness must be considered:</p>
<blockquote>
<p>H = Successive</p>
</blockquote>
<p>Each rotation is visualized to be with respect to the transformed axes of the previous rotation.</p>
<blockquote>
<p>H = Fixed</p>
</blockquote>
<p>Each rotation is visualized to be with respect to the world axes.</p>
<p>Handedness must be noted for all future operations with the numbers you just generated.</p>
<h3 id="conversions-to-1"><a class="header" href="#conversions-to-1">Conversions (To…)</a></h3>
<p><em>This is the computational bedrock of the usefulness of Euler Angles.</em> In fact, the Function and Directionality conventions only matter for conversions, and are dictated by the destination forms.</p>
<p><strong>Rotation Matrix</strong></p>
<p>See Rotation Matrix construction techniques for building the component \(\mathbf{R}_i\) matrices here.</p>
<p>First consideration is directionality of the matrices <em>(must be consistent)</em>:</p>
<blockquote>
<p>D = B2W</p>
</blockquote>
<p>$$\mathbf{R}_B^W=\mathbf{R}_3\mathbf{R}_2\mathbf{R}_1$$</p>
<blockquote>
<p>D = W2B, F = Passive</p>
</blockquote>
<p>$$\mathbf{R}_W^B=\mathbf{R}_1\mathbf{R}_2\mathbf{R}_3$$</p>
<blockquote>
<p>D = W2B, F = Active</p>
</blockquote>
<p>$$\mathbf{R}=\mathbf{R}_3\mathbf{R}_2\mathbf{R}_1$$</p>
<p>Then, take into account handedness:</p>
<blockquote>
<p>H = Successive</p>
</blockquote>
<p>Keep the above, which was derived assuming successive axes.</p>
<blockquote>
<p>H = Fixed</p>
</blockquote>
<p>Reverse the above, whatever it is:</p>
<p>$$\mathbf{R}_a\mathbf{R}_b\mathbf{R}_c \rightarrow \mathbf{R}_c\mathbf{R}_b\mathbf{R}_a$$</p>
<p>And the reversed rotations must be with respect to the chosen fixed frame. See below.</p>
<p>The aim is to prove that intrinsic and extrinsic rotation compositions are applied in reverse order from each other. To prove this, consider three frames 0,1,2, where 0 is the fixed “world” frame. Suppose that \(\mathbf{R}_2^0\) represents the rotation of the 2-frame relative to the 0-frame. To encode that rotation relative to the 1-frame requires a <strong>similarity transform</strong>, granted that the frames no longer appear to cancel out nicely:</p>
<p>$$\mathbf{R}_2^1=(\mathbf{R}_1^0)^{-1}\mathbf{R}_2^0\mathbf{R}_1^0$$</p>
<p>Placing this within the context of rotation composition to get from frame 2 to 0, the composition looks like</p>
<p>$$\mathbf{R}_2^0=\mathbf{R}_1^0\mathbf{R}_2^1=\mathbf{R}_1^0((\mathbf{R}_1^0)^{-1}\mathbf{R}_2^0\mathbf{R}_1^0)=\mathbf{R}_2^0\mathbf{R}_1^0$$</p>
<p>Note the reversed directionality between the <strong>intrinsic</strong> composition \(\mathbf{R}_1^0\mathbf{R}_2^1\) and the <em>equivalent</em> <strong>extrinsic</strong> composition \(\mathbf{R}_2^0\mathbf{R}_1^0\). Generic rotations were used here, demonstrating generalizability.</p>
<p><strong>Rodrigues</strong></p>
<p>Convert to a rotation matrix first (using the Euler Angles \(\rightarrow\) Rotation Matrix formulas above), then extract the Rodrigues vector using the \(SO(3)\) logarithmic map.</p>
<p><strong>Quaternion</strong></p>
<p><em>Direct method for 3-2-1 ordering, H = Successive:</em></p>
<p>Compose the elemental quaternions for each axis rotation:</p>
<p>$$\mathbf{q}=\mathbf{q}_3(\psi)\otimes\mathbf{q}_2(\theta)\otimes\mathbf{q}_1(\phi)$$</p>
<p>where (assuming O = \(q_w\) first):</p>
<p>$$\mathbf{q}_1(\phi)=\begin{bmatrix}\cos(\phi/2)\\ \sin(\phi/2)\\ 0\\ 0\end{bmatrix},\quad \mathbf{q}_2(\theta)=\begin{bmatrix}\cos(\theta/2)\\ 0\\ \sin(\theta/2)\\ 0\end{bmatrix},\quad \mathbf{q}_3(\psi)=\begin{bmatrix}\cos(\psi/2)\\ 0\\ 0\\ \sin(\psi/2)\end{bmatrix}$$</p>
<p>Composition order follows the same directionality/handedness rules as the Euler Angles \(\rightarrow\) Rotation Matrix conversion. Alternatively, convert to a rotation matrix first and then extract the quaternion.</p>
<h3 id="composition-and-inversion-1"><a class="header" href="#composition-and-inversion-1">Composition and Inversion</a></h3>
<p><em>Not applicable for Euler angles.</em> Composition and inversion are typically performed by first converting the Euler angles to a rotation matrix.</p>
<h3 id="derivatives-and-numeric-integration-1"><a class="header" href="#derivatives-and-numeric-integration-1">Derivatives and (Numeric) Integration</a></h3>
<p>Unlike with composition and inversion, there are methods of numeric differentiation and integration with Euler angles that are mathematically valid over infinitesimally small delta angles.</p>
<p><em>Assuming 3-2-1 ordering (\(\psi\) yaw, \(\theta\) pitch, \(\phi\) roll), H = Successive, D = B2W.</em></p>
<p><strong>Euler angle rates from body-frame angular velocity:</strong></p>
<p>$$\boldsymbol{\omega}^B=\begin{bmatrix}p\\ q\\ r\end{bmatrix}=\begin{bmatrix}1 &amp; 0 &amp; -\sin\theta\\ 0 &amp; \cos\phi &amp; \sin\phi\cos\theta\\ 0 &amp; -\sin\phi &amp; \cos\phi\cos\theta\end{bmatrix}\begin{bmatrix}\dot{\phi}\\ \dot{\theta}\\ \dot{\psi}\end{bmatrix}$$</p>
<p><strong>Inverse (for integration):</strong></p>
<p>$$\begin{bmatrix}\dot{\phi}\\ \dot{\theta}\\ \dot{\psi}\end{bmatrix}=\begin{bmatrix}1 &amp; \sin\phi\tan\theta &amp; \cos\phi\tan\theta\\ 0 &amp; \cos\phi &amp; -\sin\phi\\ 0 &amp; \sin\phi\sec\theta &amp; \cos\phi\sec\theta\end{bmatrix}\begin{bmatrix}p\\ q\\ r\end{bmatrix}$$</p>
<p>Note the singularity at \(\theta=\pm\pi/2\) in the inverse mapping (gimbal lock).</p>
<p><strong>Numeric Integration (first-order):</strong></p>
<p>$$\boldsymbol{\Theta}(t+\Delta t)\approx\boldsymbol{\Theta}(t)+\dot{\boldsymbol{\Theta}}(t)\Delta t$$</p>
<h3 id="representational-strengths-and-shortcomings-1"><a class="header" href="#representational-strengths-and-shortcomings-1">Representational Strengths and Shortcomings</a></h3>
<p><strong>Strengths</strong></p>
<ul>
<li>Can be very intuitive</li>
<li>Minimal representation</li>
</ul>
<p><strong>Shortcomings</strong></p>
<ul>
<li>There are many different orders and conventions that people don’t always specify</li>
<li>Operations with Euler angles involve trigonometric functions, and are thus slower to compute and more difficult to analyze</li>
<li><em>Singularities/Gimbal Lock</em>: For example, \(\mathbf{R}=\mathbf{R}_z(\delta)\mathbf{R}_y(\pi/2)\mathbf{R}_x(\alpha+\delta)\) for <em>any</em> choice of \(\delta\). Singularities will occur for any 3-parameter representation (J. Stuelpnagel. On the Parametrization of the Three-Dimensional Rotation Group. SIAM Review, 6(4):422-430, 1964.).</li>
</ul>
<h3 id="unit-tests-to-determine-conventions-1"><a class="header" href="#unit-tests-to-determine-conventions-1">Unit Tests to Determine Conventions</a></h3>
<ol>
<li>Set \((\psi,\theta,\phi)=(90°,0,0)\) (pure yaw) and convert to a rotation matrix.</li>
<li><strong>Ordering</strong>: Check which axis the rotation occurred about (the first number in the ordering label corresponds to the outermost rotation axis).</li>
<li><strong>Handedness</strong>: Set \((\psi,\theta,\phi)=(90°,45°,0)\). Convert to a matrix and compare against constructing the same rotations about the successive (body) axes vs. the fixed (world) axes. The one that matches determines H.</li>
<li><strong>F and D</strong>: Apply the resulting rotation matrix to a known vector and use the rotation matrix unit tests above to determine function and directionality.</li>
</ol>
<h2 id="eulerrodrigues"><a class="header" href="#eulerrodrigues">Euler/Rodrigues</a></h2>
<h3 id="construction-techniques-2"><a class="header" href="#construction-techniques-2">Construction Techniques</a></h3>
<p><em>Remember</em>, \(\mathbf{u}\) is expressed in the World frame, just as you would intuitively think.</p>
<p><strong>From Axis-Angle Representation: \(\theta\), \(\mathbf{u}\)</strong></p>
<p>Normalize \(\mathbf{u}\) and multiply by \(\theta\).</p>
<h3 id="conversions-to-2"><a class="header" href="#conversions-to-2">Conversions (To…)</a></h3>
<p>Besides tangent-space operations, this is the computational bedrock of the usefulness of Euler/Rodrigues.* In fact, as with Euler Angles, the Function and Directionality conventions only matter for conversions, and are dictated by the destination forms.</p>
<p><strong>Rotation Matrix</strong></p>
<p><em>i.e., the SO(3) exponential map</em>.</p>
<p>*i.e., Rodrigues’ rotation formula.</p>
<blockquote>
<p>D = B2W</p>
</blockquote>
<p>$$\mathbf{R}_B^W=\cos\theta\mathbf{I}+\sin\theta[\mathbf{u}]_\times+(1-\cos\theta)\mathbf{u} \mathbf{u}^T$$</p>
<p>$$=\mathbf{I}+[\mathbf{u}]_\times\sin\theta+[\mathbf{u}]_\times^2(1-\cos\theta)$$</p>
<p>$$=exp([\theta\mathbf{u}]_\times)=Exp(\theta\mathbf{u})$$</p>
<p>$$\approx \boldsymbol{I}+\lfloor \boldsymbol{\theta} \rfloor_{\times}$$</p>
<blockquote>
<p>D = W2B, F = Passive</p>
</blockquote>
<p>$$\mathbf{R}_W^B=\cos\theta\mathbf{I}-\sin\theta[\mathbf{u}]_\times+(1-\cos\theta)\mathbf{u}\mathbf{u}^T$$</p>
<p>$$=\mathbf{I}-[\mathbf{u}]_\times\sin\theta+[\mathbf{u}]_\times^2(1-\cos\theta)$$</p>
<p>$$=exp(-[\theta\mathbf{u}]_\times)=Exp(-\theta\mathbf{u})$$</p>
<p>$$\approx\boldsymbol{I}-\lfloor\boldsymbol{\theta}\rfloor_{\times}$$</p>
<blockquote>
<p>D = W2B, F = Active</p>
</blockquote>
<p>Same matrix form as D = B2W:</p>
<p>$$\mathbf{R}=\cos\theta\mathbf{I}+\sin\theta[\mathbf{u}]_\times+(1-\cos\theta)\mathbf{u}\mathbf{u}^T=Exp(\theta\mathbf{u})$$</p>
<p>$$\approx\boldsymbol{I}+\lfloor\boldsymbol{\theta}\rfloor_{\times}$$</p>
<p><strong>Euler Angles</strong></p>
<p>Convert to a rotation matrix first using the \(SO(3)\) exponential map (Rodrigues’ rotation formula above), then extract Euler angles using the Rotation Matrix \(\rightarrow\) Euler Angles formulas.</p>
<p><strong>Quaternion</strong></p>
<p><em>i.e., the Quaternion exponential map</em>.</p>
<p>Assuming O = \(q_w\) <em>first</em>.</p>
<blockquote>
<p>D = B2W</p>
</blockquote>
<p>$$\mathbf{q}=\begin{bmatrix}\cos(\theta/2) \\ \sin(\theta/2)\mathbf{u}\end{bmatrix}$$</p>
<blockquote>
<p>D = W2B, F = Passive</p>
</blockquote>
<p>$$\mathbf{q}=\begin{bmatrix}\cos(\theta/2) \\ -\sin(\theta/2)\mathbf{u}\end{bmatrix}$$</p>
<p>i.e., the conjugate of the B2W quaternion: \(\mathbf{q}_W^B=(\mathbf{q}_B^W)^{-1}\).</p>
<blockquote>
<p>D = W2B, F = Active</p>
</blockquote>
<p>$$\mathbf{q}=\begin{bmatrix}\cos(\theta/2) \\ -\sin(\theta/2)\mathbf{u}\end{bmatrix}$$</p>
<p>Same values as W2B Passive. The quaternion uses \(C_S\) instead of \(C_H\) to map to the rotation matrix, but the quaternion components are identical.</p>
<h3 id="composition-and-inversion-2"><a class="header" href="#composition-and-inversion-2">Composition and Inversion</a></h3>
<p><strong>Composition</strong></p>
<p>Rodrigues vector composition does not have a clean closed-form expression. The standard approach is to convert to rotation matrices or quaternions, compose, and convert back:</p>
<p>$$(\theta_1\mathbf{u}_1)\circ(\theta_2\mathbf{u}_2)=Log\left(Exp(\theta_1\mathbf{u}_1)\cdot Exp(\theta_2\mathbf{u}_2)\right)$$</p>
<p>For small angles, the Baker-Campbell-Hausdorff (BCH) formula provides an approximation:</p>
<p>$$Log(Exp(\mathbf{a})\cdot Exp(\mathbf{b}))\approx\mathbf{a}+\mathbf{b}+\frac{1}{2}[\mathbf{a}]_\times\mathbf{b}+\frac{1}{12}\left([\mathbf{a}]_\times^2\mathbf{b}+[\mathbf{b}]_\times^2\mathbf{a}\right)+\ldots$$</p>
<p><strong>Inversion</strong></p>
<p>$$(\theta\mathbf{u})^{-1}=-\theta\mathbf{u}$$</p>
<h3 id="derivatives-and-numeric-integration-2"><a class="header" href="#derivatives-and-numeric-integration-2">Derivatives and (Numeric) Integration</a></h3>
<p>The relationship between the Rodrigues vector rate and angular velocity involves the left and right Jacobians of \(SO(3)\):</p>
<p>$$\dot{\boldsymbol{\theta}}=\mathbf{J}_l^{-1}(\boldsymbol{\theta})\boldsymbol{\omega}^W=\mathbf{J}_r^{-1}(\boldsymbol{\theta})\boldsymbol{\omega}^B$$</p>
<p>where:</p>
<p>$$\mathbf{J}_l(\boldsymbol{\theta})=\frac{\sin\theta}{\theta}\mathbf{I}+\left(1-\frac{\sin\theta}{\theta}\right)\mathbf{u}\mathbf{u}^T+\frac{1-\cos\theta}{\theta}[\mathbf{u}]_\times$$</p>
<p>$$\mathbf{J}_r(\boldsymbol{\theta})=\mathbf{J}_l(-\boldsymbol{\theta})=\frac{\sin\theta}{\theta}\mathbf{I}+\left(1-\frac{\sin\theta}{\theta}\right)\mathbf{u}\mathbf{u}^T-\frac{1-\cos\theta}{\theta}[\mathbf{u}]_\times$$</p>
<p>The inverse left Jacobian:</p>
<p>$$\mathbf{J}_l^{-1}(\boldsymbol{\theta})=\frac{\theta/2}{\tan(\theta/2)}\mathbf{I}+\left(1-\frac{\theta/2}{\tan(\theta/2)}\right)\mathbf{u}\mathbf{u}^T-\frac{\theta}{2}[\mathbf{u}]_\times$$</p>
<p><strong>Numeric Integration:</strong></p>
<p>$$\boldsymbol{\theta}(t+\Delta t)=Log\left(Exp(\boldsymbol{\theta}(t))\cdot Exp(\boldsymbol{\omega}^B\Delta t)\right)$$</p>
<h3 id="representational-strengths-and-shortcomings-2"><a class="header" href="#representational-strengths-and-shortcomings-2">Representational Strengths and Shortcomings</a></h3>
<p><strong>Strengths</strong></p>
<ul>
<li>Constitutes the Lie Group of \(SO(3)\).</li>
<li>Easily visualized and understood</li>
<li>Minimal representation</li>
</ul>
<p><strong>Shortcomings</strong></p>
<ul>
<li>Similar to Euler Angles, operations are with trig functions, and thus slower to compute and harder to analyze (though the inverse is trivial to compute)</li>
<li>Non-unique!</li>
</ul>
<h3 id="unit-tests-to-determine-conventions-2"><a class="header" href="#unit-tests-to-determine-conventions-2">Unit Tests to Determine Conventions</a></h3>
<ol>
<li>Construct \(\boldsymbol{\theta}=(\pi/2)\hat{\mathbf{z}}\) (90° about z-axis) and convert to a rotation matrix.</li>
<li>Apply the rotation matrix unit tests to determine F and D.</li>
<li>Verify \(Exp(\mathbf{0})=\mathbf{I}\).</li>
<li>Verify \(Exp(\boldsymbol{\theta})\cdot Exp(-\boldsymbol{\theta})=\mathbf{I}\).</li>
</ol>
<h2 id="quaternions"><a class="header" href="#quaternions">Quaternions</a></h2>
<h3 id="construction-techniques-3"><a class="header" href="#construction-techniques-3">Construction Techniques</a></h3>
<p>Because quaternions are so non-intuitive, it is generally best to construct a quaternion at the outset either as the identity rotation or converted from a different representation.</p>
<h3 id="conversions-to-3"><a class="header" href="#conversions-to-3">Conversions (To…)</a></h3>
<p><strong>Rotation Matrix</strong></p>
<blockquote>
<p>D = B2W</p>
</blockquote>
<p>Hamiltonian cosine matrix:</p>
<p>$$\mathbf{R}=\mathbf{C}_H=(q_w^2-1)\boldsymbol{I}+2q_w\lfloor\boldsymbol{q}_v\rfloor_{\times}+2\boldsymbol{q}_v\boldsymbol{q}_v^{\top}=\begin{bmatrix}1-2q_y^2-2q_z^2 &amp; 2q_xq_y-2q_wq_z &amp; 2q_xq_z+2q_wq_y \\ 2q_xq_y+2q_wq_z &amp; 1-2q_x^2-2q_z^2 &amp; 2q_yq_z-2q_wq_x \\ 2q_xq_z-2q_wq_y &amp; 2q_yq_z+2q_wq_x &amp; 1-2q_x^2-2q_y^2\end{bmatrix}$$</p>
<blockquote>
<p>D = W2B, F = Passive</p>
</blockquote>
<p>$$\mathbf{R}=\mathbf{C}_H=(q_w^2-1)\boldsymbol{I}+2q_w\lfloor\boldsymbol{q}_v\rfloor_{\times}+2\boldsymbol{q}_v\boldsymbol{q}_v^{\top}=\begin{bmatrix}1-2q_y^2-2q_z^2 &amp; 2q_xq_y-2q_wq_z &amp; 2q_xq_z+2q_wq_y \\ 2q_xq_y+2q_wq_z &amp; 1-2q_x^2-2q_z^2 &amp; 2q_yq_z-2q_wq_x \\ 2q_xq_z-2q_wq_y &amp; 2q_yq_z+2q_wq_x &amp; 1-2q_x^2-2q_y^2\end{bmatrix}$$</p>
<p>Same \(C_H\) formula as B2W. The W2B passive quaternion \(\mathbf{q}_W^B=(\mathbf{q}_B^W)^{-1}\) produces \(\mathbf{R}_W^B=(\mathbf{R}_B^W)^T\) when plugged in. Note that \(C_H(\mathbf{q}_W^B)=C_S(\mathbf{q}_B^W)\).</p>
<blockquote>
<p>D = W2B, F = Active</p>
</blockquote>
<p>Shuster cosine matrix:</p>
<p>$$\mathbf{R}=\mathbf{C}_S=(q_w^2-1)\boldsymbol{I}-2q_w\lfloor\boldsymbol{q}_v\rfloor_{\times}+2\boldsymbol{q}_v\boldsymbol{q}_v^{\top}=\begin{bmatrix}1-2q_y^2-2q_z^2 &amp; 2q_xq_y+2q_wq_z &amp; 2q_xq_z-2q_wq_y \\ 2q_xq_y-2q_wq_z &amp; 1-2q_x^2-2q_z^2 &amp; 2q_yq_z+2q_wq_x \\ 2q_xq_z+2q_wq_y &amp; 2q_yq_z-2q_wq_x &amp; 1-2q_x^2-2q_y^2\end{bmatrix}$$</p>
<p>$$\mathbf{R}(\mathbf{q})=\mathbf{R}(-\mathbf{q}).$$</p>
<p>The use of \(C_H\) means that \(\text{Exp}(\tilde{q}) \approx I + [\tilde{q}]_\times \) for small \(\tilde{q}\). For \(C_S\), the approximation becomes \(I - [\tilde{q}]_\times\). A transposed matrix flips the sign again. The sign change for the active + passive world-to-body convention is important because the <em>values</em> in the actual quaternion correspond to the <em>inverse</em> of the underlying passive quaternion. Thus, all Jacobians \(\partial \cdot / \partial \tilde{q}\)  must have that negated sign to send the linearizing derivatives in the correct direction given the apparent error-state value.</p>
<p><strong>Euler Angles</strong></p>
<p><em>Assuming 3-2-1 ordering, O = \(q_w\) first, D = B2W:</em></p>
<p>$$\phi=\text{atan2}\left(2(q_wq_x+q_yq_z),1-2(q_x^2+q_y^2)\right)$$</p>
<p>$$\theta=\arcsin\left(2(q_wq_y-q_xq_z)\right)$$</p>
<p>$$\psi=\text{atan2}\left(2(q_wq_z+q_xq_y),1-2(q_y^2+q_z^2)\right)$$</p>
<p>For other conventions, convert to the rotation matrix first using the appropriate cosine matrix formula, then extract Euler angles from the matrix.</p>
<p><strong>Rodrigues</strong></p>
<p><em>i.e., the Quaternion logarithmic map.</em></p>
<p>Assuming O = \(q_w\) first:</p>
<p>if \(\lVert\mathbf{q}_v\rVert&gt;\epsilon\):</p>
<p>$$\theta\mathbf{u}=Log(\mathbf{q})=2\text{atan2}(\lVert\mathbf{q}_v\rVert,q_w)\frac{\mathbf{q}_v}{\lVert\mathbf{q}_v\rVert}$$</p>
<p>else:</p>
<p>$$\theta\mathbf{u}=Log(\mathbf{q})\approx 2\frac{\mathbf{q}_v}{q_w}$$</p>
<p>To avoid \(\theta&gt;\pi\), negate \(\mathbf{q}\) if \(q_w&lt;0\) before applying the map.</p>
<h3 id="action-1"><a class="header" href="#action-1">Action</a></h3>
<p><em>Assuming O = \(q_w\) last. Flip for \(q_w\) first.</em></p>
<blockquote>
<p>F = passive</p>
</blockquote>
<p>$$\mathbf{q}_A^B \otimes \begin{bmatrix}^A\mathbf{v} \\ 0\end{bmatrix} \otimes \left(\mathbf{q}_A^B\right)^{-1}=^B\mathbf{v}$$</p>
<p><strong>Homogeneous Coordinates:</strong></p>
<p>$$\mathbf{q}_A^B \otimes \begin{bmatrix}^A\mathbf{v} \\ 1\end{bmatrix} \otimes \left(\mathbf{q}_A^B\right)^{-1}=^B\mathbf{v}$$</p>
<blockquote>
<p>F = active</p>
</blockquote>
<p>$$\left(\mathbf{q}\right)^{-1} \otimes \begin{bmatrix}^A\mathbf{v} \\ 0\end{bmatrix} \otimes \mathbf{q}=\begin{bmatrix}^A\mathbf{v}’ \\ 0\end{bmatrix}$$</p>
<p><strong>Homogeneous Coordinates:</strong></p>
<p>$$\left(\mathbf{q}\right)^{-1} \otimes \begin{bmatrix}^A\mathbf{v} \\ 1\end{bmatrix} \otimes \mathbf{q}=\begin{bmatrix}^A\mathbf{v}’ \\ 1\end{bmatrix}$$</p>
<h3 id="composition-and-inversion-3"><a class="header" href="#composition-and-inversion-3">Composition and Inversion</a></h3>
<p><strong>Composition</strong></p>
<p>$$\mathbf{q}_1 \otimes \mathbf{q}_2=[\mathbf{q}_1]_L\mathbf{q}_2=[\mathbf{q}_2]_R\mathbf{q}_1$$</p>
<blockquote>
<p>H = Right, O = qw-first</p>
</blockquote>
<p>$$[\mathbf{q}]_L=\begin{bmatrix}q_w &amp; -\mathbf{q}_v^T \\ \mathbf{q}_v &amp; q_w\mathbf{I}+[\mathbf{q}_v]_\times\end{bmatrix}=\begin{bmatrix}q_w &amp; -q_x &amp; -q_y &amp; -q_z \\ q_x &amp; q_w &amp; -q_z &amp; q_y \\ q_y &amp; q_z &amp; q_w &amp; -q_x \\ q_z &amp; -q_y &amp; q_x &amp; q_w\end{bmatrix}$$</p>
<p>$$[\mathbf{q}]_R=\begin{bmatrix}q_w &amp; -\mathbf{q}_v^T \\ \mathbf{q}_v &amp; q_w\mathbf{I}-[\mathbf{q}_v]_\times\end{bmatrix}=\begin{bmatrix}q_w &amp; -q_x &amp; -q_y &amp; -q_z \\ q_x &amp; q_w &amp; q_z &amp; -q_y \\ q_y &amp; -q_z &amp; q_w &amp; q_x \\ q_z &amp; q_y &amp; -q_x &amp; q_w \end{bmatrix}$$</p>
<blockquote>
<p>H = Right, O = qw-last</p>
</blockquote>
<p>$$[\mathbf{q}]_L=\begin{bmatrix}q_w\mathbf{I}+[\mathbf{q}_v]_\times &amp; \mathbf{q}_v\\ -\mathbf{q}_v^T &amp; q_w\end{bmatrix}=\begin{bmatrix}q_w &amp; -q_z &amp; q_y &amp; q_x\\ q_z &amp; q_w &amp; -q_x &amp; q_y\\ -q_y &amp; q_x &amp; q_w &amp; q_z \\ -q_x &amp; -q_y &amp; -q_z &amp; q_w\end{bmatrix}$$</p>
<p>$$[\mathbf{q}]_R=\begin{bmatrix}q_w\mathbf{I}-[\mathbf{q}_v]_\times &amp; \mathbf{q}_v\\ -\mathbf{q}_v^T &amp; q_w\end{bmatrix}=\begin{bmatrix}q_w &amp; q_z &amp; -q_y &amp; q_x\\ -q_z &amp; q_w &amp; q_x &amp; q_y\\q_y &amp; -q_x &amp; q_w &amp; q_z \\ -q_x &amp; -q_y &amp; -q_z &amp; q_w\end{bmatrix}$$</p>
<blockquote>
<p>H = Left, O = qw-first</p>
</blockquote>
<p>$$[\mathbf{q}]_L=\begin{bmatrix}q_w &amp; -\mathbf{q}_v^T \\ \mathbf{q}_v &amp; q_w\mathbf{I}-[\mathbf{q}_v]_\times\end{bmatrix}=\begin{bmatrix}q_w &amp; -q_x &amp; -q_y &amp; -q_z \\ q_x &amp; q_w &amp; q_z &amp; -q_y \\ q_y &amp; -q_z &amp; q_w &amp; q_x \\ q_z &amp; q_y &amp; -q_x &amp; q_w \end{bmatrix}$$</p>
<p>$$[\mathbf{q}]_R=\begin{bmatrix}q_w &amp; -\mathbf{q}_v^T \\ \mathbf{q}_v &amp; q_w\mathbf{I}+[\mathbf{q}_v]_\times\end{bmatrix}=\begin{bmatrix}q_w &amp; -q_x &amp; -q_y &amp; -q_z \\ q_x &amp; q_w &amp; -q_z &amp; q_y \\ q_y &amp; q_z &amp; q_w &amp; -q_x \\ q_z &amp; -q_y &amp; q_x &amp; q_w\end{bmatrix}$$</p>
<blockquote>
<p>H = Left, O = qw-last</p>
</blockquote>
<p>$$[\mathbf{q}]_L=\begin{bmatrix}q_w\mathbf{I}-[\mathbf{q}_v]_\times &amp; \mathbf{q}_v \\ -\mathbf{q}_v^T &amp; q_w\end{bmatrix}=\begin{bmatrix}q_w &amp; q_z &amp; -q_y &amp; q_x \\ -q_z &amp; q_w &amp; q_x &amp; q_y\\q_y &amp; -q_x &amp; q_w &amp; q_z \\ -q_x &amp; -q_y &amp; -q_z &amp; q_w\end{bmatrix}$$</p>
<p>$$[\mathbf{q}]_R=\begin{bmatrix}q_w\mathbf{I}+[\mathbf{q}_v]_\times &amp; \mathbf{q}_v\\ -\mathbf{q}_v^T &amp; q_w\end{bmatrix}=\begin{bmatrix}q_w &amp; -q_z &amp; q_y &amp; q_x \\ q_z &amp; q_w &amp; -q_x &amp; q_y\\ -q_y &amp; q_x &amp; q_w &amp; q_z \\ -q_x &amp; -q_y &amp; -q_z &amp; q_w\end{bmatrix}$$</p>
<p>When attaching frames to the quaternions, composition has the potential for nuance due to the fact that, in certain implementations, a quaternion can be specified to represent a certain type of SO(3) rotation that actually uses different conventions from the quaternion. This seems unwise, but it happens, <em>as with certain manifestations of the JPL convention</em>. For that reason, one cannot simply exclusively pair Passive B2W behavior with active behavior, as other combinations are also fair game.</p>
<blockquote>
<p>D = B2W</p>
</blockquote>
<p>$$\mathbf{q}_A^C=\mathbf{q}_B^C\otimes \mathbf{q}_A^B$$</p>
<blockquote>
<p>D = W2B, F = Passive</p>
</blockquote>
<p>$$\mathbf{q}_A^C=\mathbf{q}_B^C\otimes \mathbf{q}_A^B$$</p>
<blockquote>
<p>D = W2B, F = Active</p>
</blockquote>
<p>$$\mathbf{q}_A^C=\mathbf{q}_A^B\otimes \mathbf{q}_B^C$$</p>
<p><strong>Inversion</strong></p>
<p>$$\mathbf{q}^{-1}=\begin{bmatrix}q_w\\ \mathbf{q}_v\end{bmatrix}^{-1}=\begin{bmatrix}q_w\\ -\mathbf{q}_v\end{bmatrix}$$</p>
<p>$$\left(\mathbf{q}_a \otimes \mathbf{q}_b \otimes \dots \otimes \mathbf{q}_N\right)^{-1}=\mathbf{q}_N^{-1}\otimes \dots \otimes \mathbf{q}_b^{-1} \otimes \mathbf{q}_a^{-1}$$</p>
<h3 id="addition-and-subtraction-1"><a class="header" href="#addition-and-subtraction-1">Addition and Subtraction</a></h3>
<p>Perturbations are represented by \(\boldsymbol{\theta}\in\mathbb{R}^3\), where local perturbations are expressed in the body frame and global perturbations are expressed in the world frame.</p>
<p><strong>Addition</strong></p>
<blockquote>
<p>D = B2W, P = Local</p>
</blockquote>
<p>$$\mathbf{q}_{B+}^{W}=\mathbf{q}_{B}^{W}\otimes\text{Exp}(\boldsymbol{\theta}_{B+}^{B})$$</p>
<blockquote>
<p>D = B2W, P = Global</p>
</blockquote>
<p>$$\mathbf{q}_{B}^{W+}=\text{Exp}(\boldsymbol{\theta}_{W}^{W+})\otimes\mathbf{q}_{B}^{W}$$</p>
<blockquote>
<p>D = W2B, F = Passive, P = Local</p>
</blockquote>
<p>$$\mathbf{q}_{W}^{B+}=\text{Exp}(\boldsymbol{\theta}_{B}^{B+})\otimes\mathbf{q}_{W}^{B}$$</p>
<p><strong>Subtraction</strong></p>
<blockquote>
<p>D = B2W, P = Local</p>
</blockquote>
<p>$$\boldsymbol{\theta}_{B+}^{B}=\text{Log}\left((\mathbf{q}_{B}^{W})^{-1}\otimes\mathbf{q}_{B+}^{W}\right)$$</p>
<blockquote>
<p>D = B2W, P = Global</p>
</blockquote>
<p>$$\boldsymbol{\theta}_{W}^{W+}=\text{Log}\left(\mathbf{q}_{B}^{W+}\otimes(\mathbf{q}_{B}^{W})^{-1}\right)$$</p>
<blockquote>
<p>D = W2B, F = Passive, P = Local</p>
</blockquote>
<p>$$\boldsymbol{\theta}_{B}^{B+}=\text{Log}\left(\mathbf{q}_{W}^{B+}\otimes(\mathbf{q}_{W}^{B})^{-1}\right)$$</p>
<h3 id="notions-of-distance-1"><a class="header" href="#notions-of-distance-1">Notions of Distance</a></h3>
<p><strong>Quaternion distance</strong></p>
<p>$$||\mathbf{q}_A-\mathbf{q}_B||=||\mathbf{q}_B-\mathbf{q}_A||$$</p>
<p>A modification to account for the negative sign ambiguity:</p>
<p>$$\min_{b\in{-1;+1}}||\mathbf{q}_A-b\mathbf{q}_B||$$</p>
<h3 id="derivatives-and-numeric-integration-3"><a class="header" href="#derivatives-and-numeric-integration-3">Derivatives and (Numeric) Integration</a></h3>
<p><em>Assuming O = \(q_w\) first, H = Right.</em></p>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>$$\dot{\mathbf{q}}_B^W=\frac{1}{2}\mathbf{q}_B^W\otimes\begin{bmatrix}0\\ \boldsymbol{\omega}^B\end{bmatrix}=\frac{1}{2}\begin{bmatrix}0\\ \boldsymbol{\omega}^W\end{bmatrix}\otimes\mathbf{q}_B^W$$</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>$$\dot{\mathbf{q}}_W^B=-\frac{1}{2}\begin{bmatrix}0\\ \boldsymbol{\omega}^B\end{bmatrix}\otimes\mathbf{q}_W^B=-\frac{1}{2}\mathbf{q}_W^B\otimes\begin{bmatrix}0\\ \boldsymbol{\omega}^W\end{bmatrix}$$</p>
<p><strong>Numeric Integration (first-order):</strong></p>
<blockquote>
<p>D = B2W:</p>
</blockquote>
<p>$$\mathbf{q}_B^W(t+\Delta t)=\mathbf{q}_B^W(t)\otimes Exp(\boldsymbol{\omega}^B\Delta t)$$</p>
<blockquote>
<p>D = W2B, F = Passive:</p>
</blockquote>
<p>$$\mathbf{q}_W^B(t+\Delta t)=Exp(-\boldsymbol{\omega}^B\Delta t)\otimes\mathbf{q}_W^B(t)$$</p>
<p>Always renormalize after integration to maintain unit norm: \(\mathbf{q}\leftarrow\mathbf{q}/\lVert\mathbf{q}\rVert\).</p>
<h3 id="representational-strengths-and-shortcomings-3"><a class="header" href="#representational-strengths-and-shortcomings-3">Representational Strengths and Shortcomings</a></h3>
<p><strong>Strengths</strong></p>
<ul>
<li>Minimal representation with <em>no singularities</em>!</li>
<li>Fast computation without resorting to trigonometry</li>
<li>Composition has 16 products instead of 27 for rotation matrices</li>
</ul>
<p><strong>Shortcomings</strong></p>
<ul>
<li>Not as intuitive as Euler Angles</li>
<li><em>Sign ambiguity</em> poses challenges that must be circumvented in control and estimation problems</li>
</ul>
<h3 id="unit-tests-to-determine-correctness"><a class="header" href="#unit-tests-to-determine-correctness">Unit Tests to Determine Correctness</a></h3>
<ol>
<li><strong>Identity</strong>: \(\mathbf{q}=[1,0,0,0]^T\) (or \([0,0,0,1]^T\) for O = \(q_w\) last) should yield \(\mathbf{R}=\mathbf{I}\).</li>
<li><strong>Inverse</strong>: \(\mathbf{q}\otimes\mathbf{q}^{-1}=\mathbf{q}_{id}\).</li>
<li><strong>Ordering</strong>: Check whether the scalar is stored first or last in the library’s data structure.</li>
<li><strong>Handedness</strong>: Compute \(\mathbf{q}_i\otimes\mathbf{q}_j\) where \(\mathbf{q}_i=[0,1,0,0]^T\) and \(\mathbf{q}_j=[0,0,1,0]^T\) (O = \(q_w\) first). Result \([0,0,0,1]^T\) implies <strong>H = Right</strong>; result \([0,0,0,-1]^T\) implies <strong>H = Left</strong>.</li>
<li><strong>Function and Directionality</strong>: Construct a quaternion for 90° about z. Convert to a rotation matrix and apply the rotation matrix convention tests.</li>
<li><strong>Double cover</strong>: Verify \(\mathbf{R}(\mathbf{q})=\mathbf{R}(-\mathbf{q})\).</li>
<li><strong>Norm preservation</strong>: \(\lVert\mathbf{q}_1\otimes\mathbf{q}_2\rVert=\lVert\mathbf{q}_1\rVert\cdot\lVert\mathbf{q}_2\rVert\).</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../Autonomy/Math_Fundamentals/3D_Geometry/3D_Geometry.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../../../Autonomy/Math_Fundamentals/Linear_Algebra/Linear_Algebra.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../Autonomy/Math_Fundamentals/3D_Geometry/3D_Geometry.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../../../Autonomy/Math_Fundamentals/Linear_Algebra/Linear_Algebra.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../../../mark-09e88c2c.min.js"></script>
        <script src="../../../searcher-c2a407aa.js"></script>

        <script src="../../../clipboard-1626706a.min.js"></script>
        <script src="../../../highlight-abc7f01d.js"></script>
        <script src="../../../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
